<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ME405 Mechatronics Romi: cotask.Task Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ME405 Mechatronics Romi
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('classcotask_1_1_task.html','','classcotask_1_1_task-members'); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">cotask.Task Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Implements multitasking with scheduling and some performance logging.  
 <a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-pub-methods" class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a2fe3b73c0ccc2cd20a89694e336291f5" id="r_a2fe3b73c0ccc2cd20a89694e336291f5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2fe3b73c0ccc2cd20a89694e336291f5">__init__</a> (self, run_fun, <a class="el" href="#ab54e069dd0b4f0a2f8e7f00c94998a10">name</a>=&quot;NoName&quot;, <a class="el" href="#aeced93c7b7d23e33de9693d278aef88b">priority</a>=0, period=None, profile=False, trace=False, shares=())</td></tr>
<tr class="memdesc:a2fe3b73c0ccc2cd20a89694e336291f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize a task object so it may be run by the scheduler.  <br /></td></tr>
<tr class="memitem:af60def0ed4a1bc5fec32f3cf8b8a90c8" id="r_af60def0ed4a1bc5fec32f3cf8b8a90c8"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af60def0ed4a1bc5fec32f3cf8b8a90c8">schedule</a> (self)</td></tr>
<tr class="memdesc:af60def0ed4a1bc5fec32f3cf8b8a90c8"><td class="mdescLeft">&#160;</td><td class="mdescRight">This method is called by the scheduler; it attempts to run this task.  <br /></td></tr>
<tr class="memitem:a6102bc35d7cb1ce292abc85d4ddc23e1" id="r_a6102bc35d7cb1ce292abc85d4ddc23e1"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6102bc35d7cb1ce292abc85d4ddc23e1">ready</a> (self)</td></tr>
<tr class="memdesc:a6102bc35d7cb1ce292abc85d4ddc23e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">This method checks if the task is ready to run.  <br /></td></tr>
<tr class="memitem:a0fcee5beb8b2fed77e5125c58ba35c26" id="r_a0fcee5beb8b2fed77e5125c58ba35c26"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0fcee5beb8b2fed77e5125c58ba35c26">set_period</a> (self, new_period)</td></tr>
<tr class="memdesc:a0fcee5beb8b2fed77e5125c58ba35c26"><td class="mdescLeft">&#160;</td><td class="mdescRight">This method sets the period between runs of the task to the given number of milliseconds, or <code>None</code> if the task is triggered by calls to <code><a class="el" href="#a8066da53e82716dc9f0495b28a89b781" title="Method to set a flag so that this task indicates that it&#39;s ready to run.">go()</a></code> rather than time.  <br /></td></tr>
<tr class="memitem:a0fd4093dcd01cd1d05ace187956340cf" id="r_a0fd4093dcd01cd1d05ace187956340cf"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0fd4093dcd01cd1d05ace187956340cf">reset_profile</a> (self)</td></tr>
<tr class="memdesc:a0fd4093dcd01cd1d05ace187956340cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">This method resets the variables used for execution time profiling.  <br /></td></tr>
<tr class="memitem:a51c5df87e0e707f9e3c02d9765fcbee1" id="r_a51c5df87e0e707f9e3c02d9765fcbee1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a51c5df87e0e707f9e3c02d9765fcbee1">get_trace</a> (self)</td></tr>
<tr class="memdesc:a51c5df87e0e707f9e3c02d9765fcbee1"><td class="mdescLeft">&#160;</td><td class="mdescRight">This method returns a string containing the task's transition trace.  <br /></td></tr>
<tr class="memitem:a8066da53e82716dc9f0495b28a89b781" id="r_a8066da53e82716dc9f0495b28a89b781"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8066da53e82716dc9f0495b28a89b781">go</a> (self)</td></tr>
<tr class="memdesc:a8066da53e82716dc9f0495b28a89b781"><td class="mdescLeft">&#160;</td><td class="mdescRight">Method to set a flag so that this task indicates that it's ready to run.  <br /></td></tr>
<tr class="memitem:a2023e255766db032de255fd65c0b1943" id="r_a2023e255766db032de255fd65c0b1943"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2023e255766db032de255fd65c0b1943">__repr__</a> (self)</td></tr>
<tr class="memdesc:a2023e255766db032de255fd65c0b1943"><td class="mdescLeft">&#160;</td><td class="mdescRight">This method converts the task to a string for diagnostic use.  <br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-pub-attribs" class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:ab54e069dd0b4f0a2f8e7f00c94998a10" id="r_ab54e069dd0b4f0a2f8e7f00c94998a10"><td class="memItemLeft" align="right" valign="top"><a id="ab54e069dd0b4f0a2f8e7f00c94998a10" name="ab54e069dd0b4f0a2f8e7f00c94998a10"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>name</b> = name</td></tr>
<tr class="memdesc:ab54e069dd0b4f0a2f8e7f00c94998a10"><td class="mdescLeft">&#160;</td><td class="mdescRight">The name of the task, hopefully a short and descriptive string. <br /></td></tr>
<tr class="memitem:aeced93c7b7d23e33de9693d278aef88b" id="r_aeced93c7b7d23e33de9693d278aef88b"><td class="memItemLeft" align="right" valign="top"><a id="aeced93c7b7d23e33de9693d278aef88b" name="aeced93c7b7d23e33de9693d278aef88b"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>priority</b> = int(priority)</td></tr>
<tr class="memdesc:aeced93c7b7d23e33de9693d278aef88b"><td class="mdescLeft">&#160;</td><td class="mdescRight">The task's priority, an integer with higher numbers meaning higher priority. <br /></td></tr>
<tr class="memitem:ad309fae1890bffafa75e9fdb33fae600" id="r_ad309fae1890bffafa75e9fdb33fae600"><td class="memItemLeft" align="right" valign="top"><a id="ad309fae1890bffafa75e9fdb33fae600" name="ad309fae1890bffafa75e9fdb33fae600"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>go_flag</b> = False</td></tr>
<tr class="memdesc:ad309fae1890bffafa75e9fdb33fae600"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag which is set true when the task is ready to be run by the scheduler. <br /></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implements multitasking with scheduling and some performance logging. </p>
<p>This class implements behavior common to tasks in a cooperative multitasking system which runs in MicroPython. The ability to be scheduled on the basis of time or an external software trigger or interrupt is implemented, state transitions can be recorded, and run times can be profiled. The user's task code must be implemented in a generator which yields the state (and the CPU) after it has run for a short and bounded period of time.</p>
<p><b>Example:</b> </p><div class="fragment"><div class="line"><span class="keyword">def </span>task1_fun ():</div>
<div class="line">     <span class="stringliteral">&#39;&#39;&#39;! This function switches states repeatedly for no reason &#39;&#39;&#39;</span></div>
<div class="line">     state = 0</div>
<div class="line">     <span class="keywordflow">while</span> <span class="keyword">True</span>:</div>
<div class="line">         <span class="keywordflow">if</span> state == 0:</div>
<div class="line">             state = 1</div>
<div class="line">         <span class="keywordflow">elif</span> state == 1:</div>
<div class="line">             state = 0</div>
<div class="line">         <span class="keywordflow">yield</span> (state)</div>
<div class="line"> </div>
<div class="line"> <span class="comment"># In main routine, create this task and set it to run twice per second</span></div>
<div class="line"> task1 = <a class="code hl_class" href="classcotask_1_1_task.html">cotask.Task</a> (task1_fun, name = <span class="stringliteral">&#39;Task 1&#39;</span>, priority = 1,</div>
<div class="line">                      period = 500, profile = <span class="keyword">True</span>, trace = <span class="keyword">True</span>)</div>
<div class="line"> </div>
<div class="line"> <span class="comment"># Add the task to the list (so it will be run) and run scheduler</span></div>
<div class="line"> cotask.task_list.append (task1)</div>
<div class="line"> <span class="keywordflow">while</span> <span class="keyword">True</span>:</div>
<div class="line">     cotask.task_list.pri_sched ()</div>
<div class="ttc" id="aclasscotask_1_1_task_html"><div class="ttname"><a href="classcotask_1_1_task.html">cotask.Task</a></div><div class="ttdoc">Implements multitasking with scheduling and some performance logging.</div><div class="ttdef"><b>Definition</b> <a href="cotask_8py_source.html#l00066">cotask.py:66</a></div></div>
</div><!-- fragment --> 
<p class="definition">Definition at line <a class="el" href="cotask_8py_source.html#l00066">66</a> of file <a class="el" href="cotask_8py_source.html">cotask.py</a>.</p>
</div><a name="doc-constructors" id="doc-constructors"></a><h2 id="header-doc-constructors" class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a2fe3b73c0ccc2cd20a89694e336291f5" name="a2fe3b73c0ccc2cd20a89694e336291f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2fe3b73c0ccc2cd20a89694e336291f5">&#9670;&#160;</a></span>__init__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cotask.Task.__init__ </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>run_fun</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>name</em></span><span class="paramdefsep"> = </span><span class="paramdefval">&quot;NoName&quot;</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>priority</em></span><span class="paramdefsep"> = </span><span class="paramdefval">0</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>period</em></span><span class="paramdefsep"> = </span><span class="paramdefval">None</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>profile</em></span><span class="paramdefsep"> = </span><span class="paramdefval">False</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>trace</em></span><span class="paramdefsep"> = </span><span class="paramdefval">False</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>shares</em></span><span class="paramdefsep"> = </span><span class="paramdefval">()</span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize a task object so it may be run by the scheduler. </p>
<p>This method initializes a task object, saving copies of constructor parameters and preparing an empty dictionary for states.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">run_fun</td><td>The function which implements the task's code. It must be a generator which yields the current state. </td></tr>
    <tr><td class="paramname">name</td><td>The name of the task, by default <code>NoName</code>. This should be overridden with a more descriptive name by the programmer. </td></tr>
    <tr><td class="paramname">priority</td><td>The priority of the task, a positive integer with higher numbers meaning higher priority (default 0) </td></tr>
    <tr><td class="paramname">period</td><td>The time in milliseconds between runs of the task if it's run by a timer or <code>None</code> if the task is not run by a timer. The time can be given in a <code>float</code> or <code>int</code>; it will be converted to microseconds for internal use by the scheduler. </td></tr>
    <tr><td class="paramname">profile</td><td>Set to <code>True</code> to enable run-time profiling </td></tr>
    <tr><td class="paramname">trace</td><td>Set to <code>True</code> to generate a list of transitions between states. <b>Note:</b> This slows things down and allocates memory. </td></tr>
    <tr><td class="paramname">shares</td><td>A list or tuple of shares and queues used by this task. If no list is given, no shares are passed to the task </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="cotask_8py_source.html#l00088">88</a> of file <a class="el" href="cotask_8py_source.html">cotask.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   88</span>    <span class="keyword">def </span>__init__(self, run_fun, name=&quot;NoName&quot;, priority=0, period=None, profile=False, trace=False, shares=()):</div>
<div class="line"><span class="lineno">   89</span>        <span class="comment"># The function which is run to implement this task&#39;s code. Since it</span></div>
<div class="line"><span class="lineno">   90</span>        <span class="comment"># is a generator, we &quot;run&quot; it here, which doesn&#39;t actually run it but</span></div>
<div class="line"><span class="lineno">   91</span>        <span class="comment"># gets it going as a generator which is ready to yield values</span></div>
<div class="line"><span class="lineno">   92</span>        <span class="keywordflow">if</span> shares:</div>
<div class="line"><span class="lineno">   93</span>            self._run_gen = run_fun(shares)</div>
<div class="line"><span class="lineno">   94</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">   95</span>            self._run_gen = run_fun()</div>
<div class="line"><span class="lineno">   96</span> </div>
<div class="line"><span class="lineno">   97</span>        </div>
<div class="line"><span class="lineno">   98</span>        self.name = name</div>
<div class="line"><span class="lineno">   99</span> </div>
<div class="line"><span class="lineno">  100</span>        </div>
<div class="line"><span class="lineno">  102</span>        self.priority = int(priority)</div>
<div class="line"><span class="lineno">  103</span> </div>
<div class="line"><span class="lineno">  104</span>        </div>
<div class="line"><span class="lineno">  109</span>        <span class="keywordflow">if</span> period != <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  110</span>            self.period = int(period * 1000)</div>
<div class="line"><span class="lineno">  111</span>            self._next_run = utime.ticks_us() + self.period</div>
<div class="line"><span class="lineno">  112</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  113</span>            self.period = period</div>
<div class="line"><span class="lineno">  114</span>            self._next_run = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  115</span> </div>
<div class="line"><span class="lineno">  116</span>        <span class="comment"># Flag which causes the task to be profiled, in which the execution</span></div>
<div class="line"><span class="lineno">  117</span>        <span class="comment">#  time of the @c run() method is measured and basic statistics kept.</span></div>
<div class="line"><span class="lineno">  118</span>        self._prof = profile</div>
<div class="line"><span class="lineno">  119</span>        self.reset_profile()</div>
<div class="line"><span class="lineno">  120</span> </div>
<div class="line"><span class="lineno">  121</span>        <span class="comment"># The previous state in which the task last ran. It is used to watch</span></div>
<div class="line"><span class="lineno">  122</span>        <span class="comment"># for and track state transitions.</span></div>
<div class="line"><span class="lineno">  123</span>        self._prev_state = 0</div>
<div class="line"><span class="lineno">  124</span> </div>
<div class="line"><span class="lineno">  125</span>        <span class="comment"># If transition tracing has been enabled, create an empty list in</span></div>
<div class="line"><span class="lineno">  126</span>        <span class="comment"># which to store transition (time, to-state) stamps</span></div>
<div class="line"><span class="lineno">  127</span>        self._trace = trace</div>
<div class="line"><span class="lineno">  128</span>        self._tr_data = []</div>
<div class="line"><span class="lineno">  129</span>        self._prev_time = utime.ticks_us()</div>
<div class="line"><span class="lineno">  130</span> </div>
<div class="line"><span class="lineno">  131</span>        </div>
<div class="line"><span class="lineno">  133</span>        self.go_flag = <span class="keyword">False</span></div>
<div class="line"><span class="lineno">  134</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="cotask_8py_source.html#l00093">_run_gen</a>.</p>

</div>
</div>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Member Function Documentation</h2>
<a id="a2023e255766db032de255fd65c0b1943" name="a2023e255766db032de255fd65c0b1943"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2023e255766db032de255fd65c0b1943">&#9670;&#160;</a></span>__repr__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cotask.Task.__repr__ </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This method converts the task to a string for diagnostic use. </p>
<p>It shows information about the task, including execution time profiling results if profiling has been done. </p><dl class="section return"><dt>Returns</dt><dd>The string which represents the task </dd></dl>

<p class="definition">Definition at line <a class="el" href="cotask_8py_source.html#l00257">257</a> of file <a class="el" href="cotask_8py_source.html">cotask.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  257</span>    <span class="keyword">def </span>__repr__(self):</div>
<div class="line"><span class="lineno">  258</span>        rst = f<span class="stringliteral">&quot;{self.name:&lt;16s}{self.priority: 4d}&quot;</span></div>
<div class="line"><span class="lineno">  259</span>        <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  260</span>            rst += f<span class="stringliteral">&quot;{(self.period / 1000.0): 10.1f}&quot;</span></div>
<div class="line"><span class="lineno">  261</span>        <span class="keywordflow">except</span> TypeError:</div>
<div class="line"><span class="lineno">  262</span>            rst += <span class="stringliteral">&quot;         -&quot;</span></div>
<div class="line"><span class="lineno">  263</span>        rst += f<span class="stringliteral">&quot;{self._runs: 8d}&quot;</span></div>
<div class="line"><span class="lineno">  264</span> </div>
<div class="line"><span class="lineno">  265</span>        <span class="keywordflow">if</span> self._prof <span class="keywordflow">and</span> self._runs &gt; 0:</div>
<div class="line"><span class="lineno">  266</span>            avg_dur = (self._run_sum / self._runs) / 1000.0</div>
<div class="line"><span class="lineno">  267</span>            avg_late = (self._late_sum / self._runs) / 1000.0</div>
<div class="line"><span class="lineno">  268</span>            rst += f<span class="stringliteral">&quot;{avg_dur: 10.3f}{(self._slowest / 1000.0): 10.3f}&quot;</span></div>
<div class="line"><span class="lineno">  269</span>            <span class="keywordflow">if</span> self.period != <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  270</span>                rst += f<span class="stringliteral">&quot;{avg_late: 10.3f}{(self._latest / 1000.0): 10.3f}&quot;</span></div>
<div class="line"><span class="lineno">  271</span>        <span class="keywordflow">return</span> rst</div>
<div class="line"><span class="lineno">  272</span> </div>
<div class="line"><span class="lineno">  273</span> </div>
<div class="line"><span class="lineno">  274</span><span class="comment"># =============================================================================</span></div>
<div class="line"><span class="lineno">  275</span> </div>
<div class="line"><span class="lineno">  276</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="cotask_8py_source.html#l00226">_late_sum</a>, <a class="el" href="cotask_8py_source.html#l00118">_prof</a>, <a class="el" href="cotask_8py_source.html#l00224">_run_sum</a>, <a class="el" href="cotask_8py_source.html#l00223">_runs</a>, and <a class="el" href="cotask_8py_source.html#l00110">period</a>.</p>

</div>
</div>
<a id="a51c5df87e0e707f9e3c02d9765fcbee1" name="a51c5df87e0e707f9e3c02d9765fcbee1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51c5df87e0e707f9e3c02d9765fcbee1">&#9670;&#160;</a></span>get_trace()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cotask.Task.get_trace </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This method returns a string containing the task's transition trace. </p>
<p>The trace is a set of tuples, each of which contains a time and the states from and to which the system transitioned. </p><dl class="section return"><dt>Returns</dt><dd>A possibly quite large string showing state transitions </dd></dl>

<p class="definition">Definition at line <a class="el" href="cotask_8py_source.html#l00233">233</a> of file <a class="el" href="cotask_8py_source.html">cotask.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  233</span>    <span class="keyword">def </span>get_trace(self):</div>
<div class="line"><span class="lineno">  234</span>        tr_str = <span class="stringliteral">&quot;Task &quot;</span> + self.name + <span class="stringliteral">&quot;:&quot;</span></div>
<div class="line"><span class="lineno">  235</span>        <span class="keywordflow">if</span> self._trace:</div>
<div class="line"><span class="lineno">  236</span>            tr_str += <span class="stringliteral">&quot;\n&quot;</span></div>
<div class="line"><span class="lineno">  237</span>            last_state = 0</div>
<div class="line"><span class="lineno">  238</span>            total_time = 0.0</div>
<div class="line"><span class="lineno">  239</span>            <span class="keywordflow">for</span> item <span class="keywordflow">in</span> self._tr_data:</div>
<div class="line"><span class="lineno">  240</span>                total_time += item[0] / 1000000.0</div>
<div class="line"><span class="lineno">  241</span>                tr_str += <span class="stringliteral">&quot;{: 12.6f}: {: 2d} -&gt; {:d}\n&quot;</span>.format(total_time, last_state, item[1])</div>
<div class="line"><span class="lineno">  242</span>                last_state = item[1]</div>
<div class="line"><span class="lineno">  243</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  244</span>            tr_str += <span class="stringliteral">&quot; not traced&quot;</span></div>
<div class="line"><span class="lineno">  245</span>        <span class="keywordflow">return</span> tr_str</div>
<div class="line"><span class="lineno">  246</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="cotask_8py_source.html#l00128">_tr_data</a>, <a class="el" href="cotask_8py_source.html#l00127">_trace</a>, and <a class="el" href="cotask_8py_source.html#l00098">name</a>.</p>

</div>
</div>
<a id="a8066da53e82716dc9f0495b28a89b781" name="a8066da53e82716dc9f0495b28a89b781"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8066da53e82716dc9f0495b28a89b781">&#9670;&#160;</a></span>go()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cotask.Task.go </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Method to set a flag so that this task indicates that it's ready to run. </p>
<p>This method may be called from an interrupt service routine or from another task which has data that this task needs to process soon. </p>

<p class="definition">Definition at line <a class="el" href="cotask_8py_source.html#l00250">250</a> of file <a class="el" href="cotask_8py_source.html">cotask.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  250</span>    <span class="keyword">def </span>go(self):</div>
<div class="line"><span class="lineno">  251</span>        self.go_flag = <span class="keyword">True</span></div>
<div class="line"><span class="lineno">  252</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="cotask_8py_source.html#l00133">go_flag</a>.</p>

</div>
</div>
<a id="a6102bc35d7cb1ce292abc85d4ddc23e1" name="a6102bc35d7cb1ce292abc85d4ddc23e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6102bc35d7cb1ce292abc85d4ddc23e1">&#9670;&#160;</a></span>ready()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> bool cotask.Task.ready </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This method checks if the task is ready to run. </p>
<p>If the task runs on a timer, this method checks what time it is; if not, this method checks the flag which indicates that the task is ready to go. This method may be overridden in descendent classes to implement some other behavior. </p>

<p class="definition">Definition at line <a class="el" href="cotask_8py_source.html#l00192">192</a> of file <a class="el" href="cotask_8py_source.html">cotask.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  192</span>    <span class="keyword">def </span>ready(self) -&gt; bool:</div>
<div class="line"><span class="lineno">  193</span>        <span class="comment"># If this task uses a timer, check if it&#39;s time to run run() again. If</span></div>
<div class="line"><span class="lineno">  194</span>        <span class="comment"># so, set go flag and set the timer to go off at the next run time</span></div>
<div class="line"><span class="lineno">  195</span>        <span class="keywordflow">if</span> self.period != <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  196</span>            late = utime.ticks_diff(utime.ticks_us(), self._next_run)</div>
<div class="line"><span class="lineno">  197</span>            <span class="keywordflow">if</span> late &gt; 0:</div>
<div class="line"><span class="lineno">  198</span>                self.go_flag = <span class="keyword">True</span></div>
<div class="line"><span class="lineno">  199</span>                self._next_run = utime.ticks_diff(self.period, -self._next_run)</div>
<div class="line"><span class="lineno">  200</span> </div>
<div class="line"><span class="lineno">  201</span>                <span class="comment"># If keeping a latency profile, record the data</span></div>
<div class="line"><span class="lineno">  202</span>                <span class="keywordflow">if</span> self._prof:</div>
<div class="line"><span class="lineno">  203</span>                    self._late_sum += late</div>
<div class="line"><span class="lineno">  204</span>                    <span class="keywordflow">if</span> late &gt; self._latest:</div>
<div class="line"><span class="lineno">  205</span>                        self._latest = late</div>
<div class="line"><span class="lineno">  206</span> </div>
<div class="line"><span class="lineno">  207</span>        <span class="comment"># If the task doesn&#39;t use a timer, we rely on go_flag to signal ready</span></div>
<div class="line"><span class="lineno">  208</span>        <span class="keywordflow">return</span> self.go_flag</div>
<div class="line"><span class="lineno">  209</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="cotask_8py_source.html#l00226">_late_sum</a>, <a class="el" href="cotask_8py_source.html#l00204">_latest</a>, <a class="el" href="cotask_8py_source.html#l00111">_next_run</a>, <a class="el" href="cotask_8py_source.html#l00118">_prof</a>, <a class="el" href="cotask_8py_source.html#l00133">go_flag</a>, and <a class="el" href="cotask_8py_source.html#l00110">period</a>.</p>

</div>
</div>
<a id="a0fd4093dcd01cd1d05ace187956340cf" name="a0fd4093dcd01cd1d05ace187956340cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0fd4093dcd01cd1d05ace187956340cf">&#9670;&#160;</a></span>reset_profile()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cotask.Task.reset_profile </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This method resets the variables used for execution time profiling. </p>
<p>This method is also used by <code><a class="el" href="#a2fe3b73c0ccc2cd20a89694e336291f5" title="Initialize a task object so it may be run by the scheduler.">__init__()</a></code> to create the variables. </p>

<p class="definition">Definition at line <a class="el" href="cotask_8py_source.html#l00222">222</a> of file <a class="el" href="cotask_8py_source.html">cotask.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  222</span>    <span class="keyword">def </span>reset_profile(self):</div>
<div class="line"><span class="lineno">  223</span>        self._runs = 0</div>
<div class="line"><span class="lineno">  224</span>        self._run_sum = 0</div>
<div class="line"><span class="lineno">  225</span>        self._slowest = 0</div>
<div class="line"><span class="lineno">  226</span>        self._late_sum = 0</div>
<div class="line"><span class="lineno">  227</span>        self._latest = 0</div>
<div class="line"><span class="lineno">  228</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="cotask_8py_source.html#l00226">_late_sum</a>, <a class="el" href="cotask_8py_source.html#l00204">_latest</a>, <a class="el" href="cotask_8py_source.html#l00224">_run_sum</a>, <a class="el" href="cotask_8py_source.html#l00223">_runs</a>, and <a class="el" href="cotask_8py_source.html#l00164">_slowest</a>.</p>

</div>
</div>
<a id="af60def0ed4a1bc5fec32f3cf8b8a90c8" name="af60def0ed4a1bc5fec32f3cf8b8a90c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af60def0ed4a1bc5fec32f3cf8b8a90c8">&#9670;&#160;</a></span>schedule()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> bool cotask.Task.schedule </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This method is called by the scheduler; it attempts to run this task. </p>
<p>If the task is not yet ready to run, this method returns <code>False</code> immediately; if this task is ready to run, it runs the task's generator up to the next <code>yield()</code> and then returns <code>True</code>.</p>
<dl class="section return"><dt>Returns</dt><dd><code>True</code> if the task ran or <code>False</code> if it did not </dd></dl>

<p class="definition">Definition at line <a class="el" href="cotask_8py_source.html#l00141">141</a> of file <a class="el" href="cotask_8py_source.html">cotask.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  141</span>    <span class="keyword">def </span>schedule(self) -&gt; bool:</div>
<div class="line"><span class="lineno">  142</span>        <span class="keywordflow">if</span> self.ready():</div>
<div class="line"><span class="lineno">  143</span> </div>
<div class="line"><span class="lineno">  144</span>            <span class="comment"># Reset the go flag for the next run</span></div>
<div class="line"><span class="lineno">  145</span>            self.go_flag = <span class="keyword">False</span></div>
<div class="line"><span class="lineno">  146</span> </div>
<div class="line"><span class="lineno">  147</span>            <span class="comment"># If profiling, save the start time</span></div>
<div class="line"><span class="lineno">  148</span>            <span class="keywordflow">if</span> self._prof:</div>
<div class="line"><span class="lineno">  149</span>                stime = utime.ticks_us()</div>
<div class="line"><span class="lineno">  150</span> </div>
<div class="line"><span class="lineno">  151</span>            <span class="comment"># Run the method belonging to the state which should be run next</span></div>
<div class="line"><span class="lineno">  152</span>            curr_state = next(self._run_gen)</div>
<div class="line"><span class="lineno">  153</span> </div>
<div class="line"><span class="lineno">  154</span>            <span class="comment"># If profiling or tracing, save timing data</span></div>
<div class="line"><span class="lineno">  155</span>            <span class="keywordflow">if</span> self._prof <span class="keywordflow">or</span> self._trace:</div>
<div class="line"><span class="lineno">  156</span>                etime = utime.ticks_us()</div>
<div class="line"><span class="lineno">  157</span> </div>
<div class="line"><span class="lineno">  158</span>            <span class="comment"># If profiling, save timing data</span></div>
<div class="line"><span class="lineno">  159</span>            <span class="keywordflow">if</span> self._prof:</div>
<div class="line"><span class="lineno">  160</span>                self._runs += 1</div>
<div class="line"><span class="lineno">  161</span>                runt = utime.ticks_diff(etime, stime)</div>
<div class="line"><span class="lineno">  162</span>                <span class="keywordflow">if</span> self._runs &gt; 2:</div>
<div class="line"><span class="lineno">  163</span>                    self._run_sum += runt</div>
<div class="line"><span class="lineno">  164</span>                    <span class="keywordflow">if</span> runt &gt; self._slowest:</div>
<div class="line"><span class="lineno">  165</span>                        self._slowest = runt</div>
<div class="line"><span class="lineno">  166</span> </div>
<div class="line"><span class="lineno">  167</span>            <span class="comment"># If transition logic tracing is on, record a transition; if not,</span></div>
<div class="line"><span class="lineno">  168</span>            <span class="comment"># ignore the state. If out of memory, switch tracing off and</span></div>
<div class="line"><span class="lineno">  169</span>            <span class="comment"># run the memory allocation garbage collector</span></div>
<div class="line"><span class="lineno">  170</span>            <span class="keywordflow">if</span> self._trace:</div>
<div class="line"><span class="lineno">  171</span>                <span class="keywordflow">try</span>:</div>
<div class="line"><span class="lineno">  172</span>                    <span class="keywordflow">if</span> curr_state != self._prev_state:</div>
<div class="line"><span class="lineno">  173</span>                        self._tr_data.append((utime.ticks_diff(etime, self._prev_time), curr_state))</div>
<div class="line"><span class="lineno">  174</span>                <span class="keywordflow">except</span> MemoryError:</div>
<div class="line"><span class="lineno">  175</span>                    self._trace = <span class="keyword">False</span></div>
<div class="line"><span class="lineno">  176</span>                    gc.collect()</div>
<div class="line"><span class="lineno">  177</span> </div>
<div class="line"><span class="lineno">  178</span>                self._prev_state = curr_state</div>
<div class="line"><span class="lineno">  179</span>                self._prev_time = etime</div>
<div class="line"><span class="lineno">  180</span> </div>
<div class="line"><span class="lineno">  181</span>            <span class="keywordflow">return</span> <span class="keyword">True</span></div>
<div class="line"><span class="lineno">  182</span> </div>
<div class="line"><span class="lineno">  183</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  184</span>            <span class="keywordflow">return</span> <span class="keyword">False</span></div>
<div class="line"><span class="lineno">  185</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="cotask_8py_source.html#l00123">_prev_state</a>, <a class="el" href="cotask_8py_source.html#l00129">_prev_time</a>, <a class="el" href="cotask_8py_source.html#l00118">_prof</a>, <a class="el" href="cotask_8py_source.html#l00093">_run_gen</a>, <a class="el" href="cotask_8py_source.html#l00224">_run_sum</a>, <a class="el" href="cotask_8py_source.html#l00223">_runs</a>, <a class="el" href="cotask_8py_source.html#l00164">_slowest</a>, <a class="el" href="cotask_8py_source.html#l00128">_tr_data</a>, <a class="el" href="cotask_8py_source.html#l00127">_trace</a>, <a class="el" href="cotask_8py_source.html#l00133">go_flag</a>, and <a class="el" href="cotask_8py_source.html#l00192">ready()</a>.</p>

</div>
</div>
<a id="a0fcee5beb8b2fed77e5125c58ba35c26" name="a0fcee5beb8b2fed77e5125c58ba35c26"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0fcee5beb8b2fed77e5125c58ba35c26">&#9670;&#160;</a></span>set_period()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">cotask.Task.set_period </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>new_period</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This method sets the period between runs of the task to the given number of milliseconds, or <code>None</code> if the task is triggered by calls to <code><a class="el" href="#a8066da53e82716dc9f0495b28a89b781" title="Method to set a flag so that this task indicates that it&#39;s ready to run.">go()</a></code> rather than time. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">new_period</td><td>The new period in milliseconds between task runs </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="cotask_8py_source.html#l00214">214</a> of file <a class="el" href="cotask_8py_source.html">cotask.py</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  214</span>    <span class="keyword">def </span>set_period(self, new_period):</div>
<div class="line"><span class="lineno">  215</span>        <span class="keywordflow">if</span> new_period <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div>
<div class="line"><span class="lineno">  216</span>            self.period = <span class="keywordtype">None</span></div>
<div class="line"><span class="lineno">  217</span>        <span class="keywordflow">else</span>:</div>
<div class="line"><span class="lineno">  218</span>            self.period = int(new_period) * 1000</div>
<div class="line"><span class="lineno">  219</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="cotask_8py_source.html#l00110">period</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>Lab Final/Files On Romi/<a class="el" href="cotask_8py_source.html">cotask.py</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>cotask</b></li><li class="navelem"><a href="classcotask_1_1_task.html">Task</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
