\doxysection{task\+\_\+share.\+Share Class Reference}
\hypertarget{classtask__share_1_1_share}{}\label{classtask__share_1_1_share}\index{task\_share.Share@{task\_share.Share}}


An item which holds data to be shared between tasks.  


Inheritance diagram for task\+\_\+share.\+Share\+:\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[height=2.000000cm]{classtask__share_1_1_share}
\end{center}
\end{figure}
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classtask__share_1_1_share_ad8263aa134dc9fa17abb7f751240f092}{\+\_\+\+\_\+init\+\_\+\+\_\+}} (self, type\+\_\+code, thread\+\_\+protect=True, name=None)
\begin{DoxyCompactList}\small\item\em Create a shared data item used to transfer data between tasks. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classtask__share_1_1_share_a6bca473510fc2d28f5b7a32f242e4e18}{put}} (self, data, in\+\_\+\+ISR=False)
\begin{DoxyCompactList}\small\item\em Write an item of data into the share. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classtask__share_1_1_share_ae5e4a0e21b274c9a76b80b8bb5eb62d3}{get}} (self, in\+\_\+\+ISR=False)
\begin{DoxyCompactList}\small\item\em Read an item of data from the share. \end{DoxyCompactList}\item 
\mbox{\hyperlink{classtask__share_1_1_share_ae764d854ffc31037a37f89211128eb98}{\+\_\+\+\_\+repr\+\_\+\+\_\+}} (self)
\begin{DoxyCompactList}\small\item\em Puts diagnostic information about the share into a string. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classtask__share_1_1_base_share}{task\+\_\+share.\+Base\+Share}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classtask__share_1_1_base_share_ad8079b40800179be6c58aaac9abb0e26}{\+\_\+\+\_\+init\+\_\+\+\_\+}} (self, type\+\_\+code, thread\+\_\+protect=True, name=None)
\begin{DoxyCompactList}\small\item\em Create a base queue object when called by a child class initializer. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Static Public Attributes}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{classtask__share_1_1_share_a2e8df029af46fbfd44ef0c2e7e8c7af6}\label{classtask__share_1_1_share_a2e8df029af46fbfd44ef0c2e7e8c7af6} 
int {\bfseries ser\+\_\+num} = 0
\begin{DoxyCompactList}\small\item\em A counter used to give serial numbers to shares for diagnostic use. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
An item which holds data to be shared between tasks. 

This class implements a shared data item which can be protected against data corruption by pre-\/emptive multithreading. Multithreading which can corrupt shared data includes the use of ordinary interrupts as well as the use of pre-\/emptive multithreading such as by a Real-\/\+Time Operating System (RTOS).

An example of the creation and use of a share is as follows\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{keyword}{import}\ task\_share}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{\#\ This\ share\ holds\ a\ signed\ short\ (16-\/bit)\ integer}}
\DoxyCodeLine{my\_share\ =\ \mbox{\hyperlink{classtask__share_1_1_queue}{task\_share.Queue}}\ (\textcolor{stringliteral}{'h'},\ name=\textcolor{stringliteral}{"{}My\ Share"{}})}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{\#\ Somewhere\ in\ one\ task,\ put\ data\ into\ the\ share}}
\DoxyCodeLine{my\_share.put\ (some\_data)}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{\#\ In\ another\ task,\ read\ data\ from\ the\ share}}
\DoxyCodeLine{something\ =\ my\_share.get\ ()}

\end{DoxyCode}
 

Definition at line \mbox{\hyperlink{task__share_8py_source_l00324}{324}} of file \mbox{\hyperlink{task__share_8py_source}{task\+\_\+share.\+py}}.



\label{doc-constructors}
\Hypertarget{classtask__share_1_1_share_doc-constructors}
\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classtask__share_1_1_share_ad8263aa134dc9fa17abb7f751240f092}\index{task\_share.Share@{task\_share.Share}!\_\_init\_\_@{\_\_init\_\_}}
\index{\_\_init\_\_@{\_\_init\_\_}!task\_share.Share@{task\_share.Share}}
\doxysubsubsection{\texorpdfstring{\_\_init\_\_()}{\_\_init\_\_()}}
{\footnotesize\ttfamily \label{classtask__share_1_1_share_ad8263aa134dc9fa17abb7f751240f092} 
task\+\_\+share.\+Share.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{}]{type\+\_\+code}{, }\item[{}]{thread\+\_\+protect}{ = {\ttfamily True}, }\item[{}]{name}{ = {\ttfamily None}}\end{DoxyParamCaption})}



Create a shared data item used to transfer data between tasks. 

This method allocates memory in which the shared data will be buffered.

Each share can only carry data of one particular type which must be chosen from the following list. The data type is specified by a one-\/letter type code which is given as for the Python {\ttfamily array.\+array} type, which can be any of the following\+: 
\begin{DoxyTable}{3}{}{}{1}
\SetCell{bg=\tableheadbgcolor,font=\bfseries}&\SetCell{bg=\tableheadbgcolor,font=\bfseries}&\SetCell{bg=\tableheadbgcolor,font=\bfseries}\\
{\bfseries{b}} (signed char)  &{\bfseries{B}} (unsigned char)  &8 bit integers  \\
{\bfseries{h}} (signed short)  &{\bfseries{H}} (unsigned short)  &16 bit integers  \\
{\bfseries{i}} (signed int)  &{\bfseries{I}} (unsigned int)  &32 bit integers (probably)  \\
{\bfseries{l}} (signed long)  &{\bfseries{L}} (unsigned long)  &32 bit integers  \\
{\bfseries{q}} (signed long long)  &{\bfseries{Q}} (unsigned long long)  &64 bit integers  \\
{\bfseries{f}} (float)  &{\bfseries{d}} (double-\/precision float)  &\\
\end{DoxyTable}



\begin{DoxyParams}{Parameters}
{\em type\+\_\+code} & The type of data items which the share can hold \\
\hline
{\em thread\+\_\+protect} & True if mutual exclusion protection is used \\
\hline
{\em name} & A short name for the share, default {\ttfamily ShareN} where {\ttfamily N} is a serial number for the share \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{task__share_8py_source_l00350}{350}} of file \mbox{\hyperlink{task__share_8py_source}{task\+\_\+share.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00350\ \ \ \ \ \textcolor{keyword}{def\ }\_\_init\_\_(self,\ type\_code,\ thread\_protect=True,\ name=None):}
\DoxyCodeLine{00351\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ First\ call\ the\ parent\ class\ initializer}}
\DoxyCodeLine{00352\ \ \ \ \ \ \ \ \ super().\_\_init\_\_(type\_code,\ thread\_protect,\ name)}
\DoxyCodeLine{00353\ }
\DoxyCodeLine{00354\ \ \ \ \ \ \ \ \ self.\_buffer\ =\ array.array(type\_code,\ [0])}
\DoxyCodeLine{00355\ }
\DoxyCodeLine{00356\ \ \ \ \ \ \ \ \ self.\_name\ =\ str(name)\ \textcolor{keywordflow}{if}\ name\ !=\ \textcolor{keywordtype}{None}\ \textcolor{keywordflow}{else}\ \textcolor{stringliteral}{"{}Share"{}}\ +\ str(Share.ser\_num)}
\DoxyCodeLine{00357\ \ \ \ \ \ \ \ \ Share.ser\_num\ +=\ 1}
\DoxyCodeLine{00358\ }

\end{DoxyCode}


References \mbox{\hyperlink{task__share_8py_source_l00350}{\+\_\+\+\_\+init\+\_\+\+\_\+()}}, \mbox{\hyperlink{task__share_8py_source_l00139}{task\+\_\+share.\+Queue.\+\_\+buffer}}, \mbox{\hyperlink{task__share_8py_source_l00354}{\+\_\+buffer}}, \mbox{\hyperlink{task__share_8py_source_l00134}{task\+\_\+share.\+Queue.\+\_\+name}}, and \mbox{\hyperlink{task__share_8py_source_l00356}{\+\_\+name}}.



\label{doc-func-members}
\Hypertarget{classtask__share_1_1_share_doc-func-members}
\doxysubsection{Member Function Documentation}
\Hypertarget{classtask__share_1_1_share_ae764d854ffc31037a37f89211128eb98}\index{task\_share.Share@{task\_share.Share}!\_\_repr\_\_@{\_\_repr\_\_}}
\index{\_\_repr\_\_@{\_\_repr\_\_}!task\_share.Share@{task\_share.Share}}
\doxysubsubsection{\texorpdfstring{\_\_repr\_\_()}{\_\_repr\_\_()}}
{\footnotesize\ttfamily \label{classtask__share_1_1_share_ae764d854ffc31037a37f89211128eb98} 
task\+\_\+share.\+Share.\+\_\+\+\_\+repr\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self}{}\end{DoxyParamCaption})}



Puts diagnostic information about the share into a string. 

Shares are pretty simple, so we just put the name and type. 

Definition at line \mbox{\hyperlink{task__share_8py_source_l00403}{403}} of file \mbox{\hyperlink{task__share_8py_source}{task\+\_\+share.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00403\ \ \ \ \ \textcolor{keyword}{def\ }\_\_repr\_\_(self):}
\DoxyCodeLine{00404\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{stringliteral}{"{}\{:<12s\}\ Share<\{:s\}>"{}}.format(self.\_name,\ type\_code\_strings[self.\_type\_code])}

\end{DoxyCode}


References \mbox{\hyperlink{task__share_8py_source_l00134}{task\+\_\+share.\+Queue.\+\_\+name}}, \mbox{\hyperlink{task__share_8py_source_l00356}{\+\_\+name}}, and \mbox{\hyperlink{task__share_8py_source_l00070}{task\+\_\+share.\+Base\+Share.\+\_\+type\+\_\+code}}.

\Hypertarget{classtask__share_1_1_share_ae5e4a0e21b274c9a76b80b8bb5eb62d3}\index{task\_share.Share@{task\_share.Share}!get@{get}}
\index{get@{get}!task\_share.Share@{task\_share.Share}}
\doxysubsubsection{\texorpdfstring{get()}{get()}}
{\footnotesize\ttfamily \label{classtask__share_1_1_share_ae5e4a0e21b274c9a76b80b8bb5eb62d3} 
task\+\_\+share.\+Share.\+get (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{}]{in\+\_\+\+ISR}{ = {\ttfamily False}}\end{DoxyParamCaption})}



Read an item of data from the share. 

If thread protection is enabled, interrupts are disabled during the time that the data is being read so as to prevent data corruption by changes in the data as it is being read. 
\begin{DoxyParams}{Parameters}
{\em in\+\_\+\+ISR} & Set this to True if calling from within an ISR \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{task__share_8py_source_l00387}{387}} of file \mbox{\hyperlink{task__share_8py_source}{task\+\_\+share.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00387\ \ \ \ \ \textcolor{keyword}{def\ }get(self,\ in\_ISR=False):}
\DoxyCodeLine{00388\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Disable\ interrupts\ before\ reading\ the\ data}}
\DoxyCodeLine{00389\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\_thread\_protect\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{not}\ in\_ISR:}
\DoxyCodeLine{00390\ \ \ \ \ \ \ \ \ \ \ \ \ irq\_state\ =\ pyb.disable\_irq()}
\DoxyCodeLine{00391\ }
\DoxyCodeLine{00392\ \ \ \ \ \ \ \ \ to\_return\ =\ self.\_buffer[0]}
\DoxyCodeLine{00393\ }
\DoxyCodeLine{00394\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Re-\/enable\ interrupts}}
\DoxyCodeLine{00395\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\_thread\_protect\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{not}\ in\_ISR:}
\DoxyCodeLine{00396\ \ \ \ \ \ \ \ \ \ \ \ \ pyb.enable\_irq(irq\_state)}
\DoxyCodeLine{00397\ }
\DoxyCodeLine{00398\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ to\_return}
\DoxyCodeLine{00399\ }

\end{DoxyCode}


References \mbox{\hyperlink{task__share_8py_source_l00139}{task\+\_\+share.\+Queue.\+\_\+buffer}}, \mbox{\hyperlink{task__share_8py_source_l00354}{\+\_\+buffer}}, and \mbox{\hyperlink{task__share_8py_source_l00071}{task\+\_\+share.\+Base\+Share.\+\_\+thread\+\_\+protect}}.

\Hypertarget{classtask__share_1_1_share_a6bca473510fc2d28f5b7a32f242e4e18}\index{task\_share.Share@{task\_share.Share}!put@{put}}
\index{put@{put}!task\_share.Share@{task\_share.Share}}
\doxysubsubsection{\texorpdfstring{put()}{put()}}
{\footnotesize\ttfamily \label{classtask__share_1_1_share_a6bca473510fc2d28f5b7a32f242e4e18} 
task\+\_\+share.\+Share.\+put (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{}]{data}{, }\item[{}]{in\+\_\+\+ISR}{ = {\ttfamily False}}\end{DoxyParamCaption})}



Write an item of data into the share. 

This method puts data into the share; any old data is overwritten. This code disables interrupts during the writing so as to prevent data corrupting by an interrupt service routine which might access the same data. 
\begin{DoxyParams}{Parameters}
{\em data} & The data to be put into this share \\
\hline
{\em in\+\_\+\+ISR} & Set this to True if calling from within an ISR \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{task__share_8py_source_l00368}{368}} of file \mbox{\hyperlink{task__share_8py_source}{task\+\_\+share.\+py}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00368\ \ \ \ \ \textcolor{keyword}{def\ }put(self,\ data,\ in\_ISR=False):}
\DoxyCodeLine{00369\ }
\DoxyCodeLine{00370\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Disable\ interrupts\ before\ writing\ the\ data}}
\DoxyCodeLine{00371\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\_thread\_protect\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{not}\ in\_ISR:}
\DoxyCodeLine{00372\ \ \ \ \ \ \ \ \ \ \ \ \ irq\_state\ =\ pyb.disable\_irq()}
\DoxyCodeLine{00373\ }
\DoxyCodeLine{00374\ \ \ \ \ \ \ \ \ self.\_buffer[0]\ =\ data}
\DoxyCodeLine{00375\ }
\DoxyCodeLine{00376\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Re-\/enable\ interrupts}}
\DoxyCodeLine{00377\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\_thread\_protect\ \textcolor{keywordflow}{and}\ \textcolor{keywordflow}{not}\ in\_ISR:}
\DoxyCodeLine{00378\ \ \ \ \ \ \ \ \ \ \ \ \ pyb.enable\_irq(irq\_state)}
\DoxyCodeLine{00379\ }

\end{DoxyCode}


References \mbox{\hyperlink{task__share_8py_source_l00139}{task\+\_\+share.\+Queue.\+\_\+buffer}}, \mbox{\hyperlink{task__share_8py_source_l00354}{\+\_\+buffer}}, and \mbox{\hyperlink{task__share_8py_source_l00071}{task\+\_\+share.\+Base\+Share.\+\_\+thread\+\_\+protect}}.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
Lab Final/\+Files On Romi/\mbox{\hyperlink{task__share_8py}{task\+\_\+share.\+py}}\end{DoxyCompactItemize}
