\doxysection{Encoder.\+py}
\hypertarget{_encoder_8py_source}{}\label{_encoder_8py_source}\index{Lab Final/Files On Romi/Encoder.py@{Lab Final/Files On Romi/Encoder.py}}
\mbox{\hyperlink{_encoder_8py}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00001}\mbox{\hyperlink{namespace_encoder}{00001}}\ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00018}00018\ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00019}00019\ \textcolor{keyword}{from}\ pyb\ \textcolor{keyword}{import}\ Pin,\ Timer\ \ \textcolor{comment}{\#\ pyright:\ ignore}}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00020}00020\ \textcolor{keyword}{from}\ Sensor\ \textcolor{keyword}{import}\ Sensor}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00021}00021\ \textcolor{keyword}{from}\ Romi\_Props\ \textcolor{keyword}{import}\ RomiProps}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00022}00022\ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00023}00023\ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00024}00024\ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00029}\mbox{\hyperlink{class_encoder_1_1_encoder}{00029}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_encoder_1_1_encoder}{Encoder}}(\mbox{\hyperlink{class_sensor_1_1_sensor}{Sensor}}):}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00030}00030\ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00031}00031\ \ \ \ \ \textcolor{comment}{\#\ Default\ Gains\ for\ Motor\ Control}}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00032}\mbox{\hyperlink{class_encoder_1_1_encoder_acf49ca39b8a870b86b608ef4ec9f507d}{00032}}\ \ \ \ \ Kp\ =\ 0.05}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00033}\mbox{\hyperlink{class_encoder_1_1_encoder_a42c8fb766db0956d4cccb2114a57e4eb}{00033}}\ \ \ \ \ Ki\ =\ 0.05}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00034}\mbox{\hyperlink{class_encoder_1_1_encoder_aa930e1d02919262e23c697d0e0a67bb3}{00034}}\ \ \ \ \ Kd\ =\ 0}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00035}\mbox{\hyperlink{class_encoder_1_1_encoder_a7c82d6078e4da87365d1ab09b787734b}{00035}}\ \ \ \ \ Kw\ =\ 0.10}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00036}\mbox{\hyperlink{class_encoder_1_1_encoder_aa042bd20ee3d5f417e38ac84c0018c74}{00036}}\ \ \ \ \ Kff\ =\ 0.075}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00037}00037\ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00038}\mbox{\hyperlink{class_encoder_1_1_encoder_a06d0075dd3bbccf95dae20e3769c38f6}{00038}}\ \ \ \ \ PWM\_startl\ =\ 5.5}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00039}\mbox{\hyperlink{class_encoder_1_1_encoder_a2f1ece000ee65d95a7dba3ca75246223}{00039}}\ \ \ \ \ PWM\_startr\ =\ 5.5}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00040}00040\ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00041}00041\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00049}\mbox{\hyperlink{class_encoder_1_1_encoder_aaf03c8c07b265741974d6a8f7d8c25db}{00049}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{class_encoder_1_1_encoder_aaf03c8c07b265741974d6a8f7d8c25db}{\_\_init\_\_}}(self,\ motor,\ tim:\ Timer,\ chA\_pin,\ chA\_num:\ int,\ chB\_pin,\ chB\_num:\ int):}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00050}00050\ \ \ \ \ \ \ \ \ super().\mbox{\hyperlink{class_encoder_1_1_encoder_aaf03c8c07b265741974d6a8f7d8c25db}{\_\_init\_\_}}()}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00051}00051\ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00052}\mbox{\hyperlink{class_encoder_1_1_encoder_a396482f541be6246f852207da4549c50}{00052}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a396482f541be6246f852207da4549c50}{motor}}\ =\ motor}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00053}\mbox{\hyperlink{class_encoder_1_1_encoder_aed52f4ae493169a30d1053ef155d89e3}{00053}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_encoder_1_1_encoder_aed52f4ae493169a30d1053ef155d89e3}{\_position}}\ =\ 0\ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Accumulated\ wheel\ position\ (rad)}}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00054}\mbox{\hyperlink{class_encoder_1_1_encoder_a4833ccfbac5153c4f3262b035729e974}{00054}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a4833ccfbac5153c4f3262b035729e974}{prev\_count}}\ =\ 0\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Last\ timer\ count}}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00055}\mbox{\hyperlink{class_encoder_1_1_encoder_a2308e3a2ab31eae5118dadfe5a955bf2}{00055}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a2308e3a2ab31eae5118dadfe5a955bf2}{delta}}\ =\ 0\ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Tick\ difference\ between\ updates}}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00056}00056\ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00057}\mbox{\hyperlink{class_encoder_1_1_encoder_af374aae717869154cd576f8c218ee893}{00057}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_encoder_1_1_encoder_af374aae717869154cd576f8c218ee893}{ar}}\ =\ tim.period()\ \ \ \ \ \ \textcolor{comment}{\#\ Auto-\/reload\ value}}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00058}\mbox{\hyperlink{class_encoder_1_1_encoder_a382ad8b72c52f9f092e7da87a55a17a5}{00058}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a382ad8b72c52f9f092e7da87a55a17a5}{tim}}\ =\ tim}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00059}00059\ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00060}00060\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Configure\ pins\ and\ timer\ channels}}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00061}\mbox{\hyperlink{class_encoder_1_1_encoder_a446ccf4e54570b0f86b84d42770c9f77}{00061}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a446ccf4e54570b0f86b84d42770c9f77}{chA\_pin}}\ =\ Pin(chA\_pin,\ mode=Pin.IN)}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00062}\mbox{\hyperlink{class_encoder_1_1_encoder_ac3775fb335ea931b85c9942ea55d994f}{00062}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_encoder_1_1_encoder_ac3775fb335ea931b85c9942ea55d994f}{chB\_pin}}\ =\ Pin(chB\_pin,\ mode=Pin.IN)}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00063}\mbox{\hyperlink{class_encoder_1_1_encoder_a117693752e24d2ccce1432dcb3c48708}{00063}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a117693752e24d2ccce1432dcb3c48708}{chA}}\ =\ tim.channel(chA\_num,\ pin=self.\mbox{\hyperlink{class_encoder_1_1_encoder_a446ccf4e54570b0f86b84d42770c9f77}{chA\_pin}},\ mode=Timer.ENC\_AB)}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00064}\mbox{\hyperlink{class_encoder_1_1_encoder_a43c719e3b6ee3b6b86a29caf21b76858}{00064}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a43c719e3b6ee3b6b86a29caf21b76858}{chB}}\ =\ tim.channel(chB\_num,\ pin=self.\mbox{\hyperlink{class_encoder_1_1_encoder_ac3775fb335ea931b85c9942ea55d994f}{chB\_pin}},\ mode=Timer.ENC\_AB)}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00065}00065\ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00066}00066\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00069}00069\ \ \ \ \ \textcolor{preprocessor}{@property}}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00070}\mbox{\hyperlink{class_encoder_1_1_encoder_a6d2eb2fb79cbc8fa4674a0697bcd1b48}{00070}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{class_encoder_1_1_encoder_a6d2eb2fb79cbc8fa4674a0697bcd1b48}{position}}(self)\ -\/>\ float:}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00071}00071\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/self.\mbox{\hyperlink{class_encoder_1_1_encoder_aed52f4ae493169a30d1053ef155d89e3}{\_position}}}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00072}00072\ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00073}00073\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00076}00076\ \ \ \ \ \textcolor{preprocessor}{@position.setter}}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00077}\mbox{\hyperlink{class_encoder_1_1_encoder_a5ed1fa42676a8cdf235aefe1dc799036}{00077}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{class_encoder_1_1_encoder_a6d2eb2fb79cbc8fa4674a0697bcd1b48}{position}}(self,\ value:\ float)\ -\/>\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00078}00078\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_encoder_1_1_encoder_aed52f4ae493169a30d1053ef155d89e3}{\_position}}\ =\ -\/value}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00079}00079\ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00080}00080\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00085}00085\ \ \ \ \ \textcolor{preprocessor}{@property}}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00086}\mbox{\hyperlink{class_encoder_1_1_encoder_a350e18a3d12255c04ae76cbebd0e9a6c}{00086}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{class_encoder_1_1_encoder_a350e18a3d12255c04ae76cbebd0e9a6c}{velocity}}(self)\ -\/>\ float:}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00087}00087\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a2308e3a2ab31eae5118dadfe5a955bf2}{delta}}\ ==\ 0\ \textcolor{keywordflow}{or}\ self.\mbox{\hyperlink{class_sensor_1_1_sensor_a6e6d3fb512659ab212a323467c6e0b91}{dt}}\ ==\ 0:}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00088}00088\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00089}00089\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ -\/(self.\mbox{\hyperlink{class_encoder_1_1_encoder_a2308e3a2ab31eae5118dadfe5a955bf2}{delta}}\ *\ RomiProps.wheel\_radius\ *\ 1e6)\ /\ self.\mbox{\hyperlink{class_sensor_1_1_sensor_a6e6d3fb512659ab212a323467c6e0b91}{dt}}}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00090}00090\ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00091}00091\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00098}\mbox{\hyperlink{class_encoder_1_1_encoder_a38735c3e7480ced90b58e80e2704d677}{00098}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{class_encoder_1_1_encoder_a38735c3e7480ced90b58e80e2704d677}{update}}(self)\ -\/>\ None:}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00099}00099\ \ \ \ \ \ \ \ \ count\ =\ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a382ad8b72c52f9f092e7da87a55a17a5}{tim}}.counter()}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00100}00100\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a2308e3a2ab31eae5118dadfe5a955bf2}{delta}}\ =\ count\ -\/\ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a4833ccfbac5153c4f3262b035729e974}{prev\_count}}}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00101}00101\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a4833ccfbac5153c4f3262b035729e974}{prev\_count}}\ =\ count}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00102}00102\ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00103}00103\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Wrap-\/around\ correction}}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00104}00104\ \ \ \ \ \ \ \ \ half\_range\ =\ (self.\mbox{\hyperlink{class_encoder_1_1_encoder_af374aae717869154cd576f8c218ee893}{ar}}\ +\ 1)\ /\ 2}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00105}00105\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a2308e3a2ab31eae5118dadfe5a955bf2}{delta}}\ <\ -\/half\_range:}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00106}00106\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a2308e3a2ab31eae5118dadfe5a955bf2}{delta}}\ +=\ self.\mbox{\hyperlink{class_encoder_1_1_encoder_af374aae717869154cd576f8c218ee893}{ar}}\ +\ 1}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00107}00107\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a2308e3a2ab31eae5118dadfe5a955bf2}{delta}}\ >\ half\_range:}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00108}00108\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a2308e3a2ab31eae5118dadfe5a955bf2}{delta}}\ -\/=\ self.\mbox{\hyperlink{class_encoder_1_1_encoder_af374aae717869154cd576f8c218ee893}{ar}}\ +\ 1}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00109}00109\ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00110}00110\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Convert\ to\ radians\ and\ accumulate}}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00111}00111\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a2308e3a2ab31eae5118dadfe5a955bf2}{delta}}\ *=\ RomiProps.ticks\_to\_rads}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00112}00112\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_encoder_1_1_encoder_aed52f4ae493169a30d1053ef155d89e3}{\_position}}\ +=\ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a2308e3a2ab31eae5118dadfe5a955bf2}{delta}}}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00113}00113\ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00114}00114\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Update\ timing\ from\ Sensor\ base\ class}}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00115}00115\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_sensor_1_1_sensor_a49cdbda3f5a9c633664e069b976be896}{update\_dt}}()}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00116}00116\ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00117}00117\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00122}\mbox{\hyperlink{class_encoder_1_1_encoder_adbf9d1c5ade7dd439d00c60d238c5aad}{00122}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{class_encoder_1_1_encoder_adbf9d1c5ade7dd439d00c60d238c5aad}{get\_data}}(self)\ -\/>\ float:}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00123}00123\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a350e18a3d12255c04ae76cbebd0e9a6c}{velocity}}}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00124}00124\ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00125}00125\ \ \ \ \ }
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00128}\mbox{\hyperlink{class_encoder_1_1_encoder_a02c0a2ebcfb0989ea1cc849a6525d342}{00128}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{class_encoder_1_1_encoder_a02c0a2ebcfb0989ea1cc849a6525d342}{zero}}(self)\ -\/>\ None:}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00129}00129\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_encoder_1_1_encoder_aed52f4ae493169a30d1053ef155d89e3}{\_position}}\ =\ 0}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00130}00130\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a4833ccfbac5153c4f3262b035729e974}{prev\_count}}\ =\ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a382ad8b72c52f9f092e7da87a55a17a5}{tim}}.counter()}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00131}00131\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_encoder_1_1_encoder_a2308e3a2ab31eae5118dadfe5a955bf2}{delta}}\ =\ 0}
\DoxyCodeLine{\Hypertarget{_encoder_8py_source_l00132}00132\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{class_sensor_1_1_sensor_affeced0c1599dffadd293a9823ede43e}{reset\_timing}}()}

\end{DoxyCode}
